<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人生修复指南 | Life Repair Protocol</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfaf7; color: #1c1917; margin: 0; }
        .serif { font-family: 'Noto Serif SC', serif; }
        .glass-card { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid #e7e5e4; }
        textarea:focus { outline: none; border-color: #444; }
        @media print { .no-print { display: none !important; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // 简单的图标组件，兼容本地加载
        const Icon = ({ name, size = 20, className = "" }) => {
            useEffect(() => { lucide.createIcons(); }, []);
            return <i data-lucide={name} style={{ width: size, height: size }} className={className}></i>;
        };

        const App = () => {
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem('life-repair-data-v2');
                return saved ? JSON.parse(saved) : {
                    commitment: false,
                    antiVision: { health: '', finance: '', work: '' },
                    identity: { iam: '' }
                };
            });

            useEffect(() => {
                localStorage.setItem('life-repair-data-v2', JSON.stringify(state));
                lucide.createIcons(); // 初始加载图标
            }, [state]);

            const updateField = (cat, field, val) => {
                setState(prev => ({ ...prev, [cat]: { ...prev[cat], [field]: val } }));
            };

            const scrollTo = (id) => {
                document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });
            };

            return (
                <div className="max-w-3xl mx-auto px-6 py-20 pb-32">
                    {/* Header */}
                    <section id="intro" className="min-h-[60vh] flex flex-col justify-center items-center text-center space-y-8">
                        <h1 className="text-5xl font-bold serif tracking-tight">人生修复协议</h1>
                        <div className="p-6 bg-white border border-stone-200 rounded-2xl italic text-stone-600 serif max-w-lg">
                            “你想拥有的生活，建立在你不敢放手的废墟之上。”
                        </div>
                        <button 
                            onClick={() => { setState(p => ({...p, commitment: true})); setTimeout(() => scrollTo('phase-1'), 100); }}
                            className="px-10 py-4 bg-stone-900 text-white rounded-full font-bold shadow-xl hover:scale-105 transition-transform"
                        >
                            签写协议并进入系统
                        </button>
                    </section>

                    {/* Phase 1 */}
                    <section id="phase-1" className={`mt-32 space-y-12 transition-all duration-700 ${state.commitment ? 'opacity-100' : 'opacity-20 pointer-events-none'}`}>
                        <div className="flex items-center gap-3 border-b border-stone-200 pb-4">
                            <Icon name="shield-alert" className="text-orange-600" />
                            <h2 className="text-3xl font-bold serif">01. 反向愿景</h2>
                        </div>
                        
                        <div className="space-y-8">
                            <div>
                                <label className="block text-xs font-bold text-stone-400 uppercase tracking-widest mb-2">健康与能量腐败</label>
                                <textarea 
                                    value={state.antiVision.health}
                                    onChange={(e) => updateField('antiVision', 'health', e.target.value)}
                                    placeholder="描述你不改变现状后，5年后的身体废墟..."
                                    className="w-full h-40 p-6 bg-white border border-stone-200 rounded-2xl shadow-sm focus:ring-2 focus:ring-stone-200"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-bold text-stone-400 uppercase tracking-widest mb-2">财务尊严丧失</label>
                                <textarea 
                                    value={state.antiVision.finance}
                                    onChange={(e) => updateField('antiVision', 'finance', e.target.value)}
                                    placeholder="如果你继续平庸，你将不得不对谁低头？"
                                    className="w-full h-40 p-6 bg-white border border-stone-200 rounded-2xl shadow-sm focus:ring-2 focus:ring-stone-200"
                                />
                            </div>
                        </div>
                        <button onClick={() => scrollTo('phase-2')} className="w-full py-4 border-2 border-stone-900 rounded-full font-bold hover:bg-stone-900 hover:text-white transition-all">
                            下一步：重塑身份 →
                        </button>
                    </section>

                    {/* Phase 2 */}
                    <section id="phase-2" className="mt-32 space-y-12">
                        <div className="flex items-center gap-3 border-b border-stone-200 pb-4">
                            <Icon name="zap" className="text-yellow-500" />
                            <h2 className="text-3xl font-bold serif">02. 身份重构</h2>
                        </div>
                        <textarea 
                            value={state.identity.iam}
                            onChange={(e) => updateField('identity', 'iam', e.target.value)}
                            placeholder="我是谁？（例如：我是一个通过自律获得自由的创作者）"
                            className="w-full h-48 p-8 bg-stone-900 text-stone-100 rounded-3xl shadow-2xl focus:ring-4 focus:ring-stone-700"
                        />
                        <div className="flex gap-4 no-print">
                            <button onClick={() => window.print()} className="flex-1 py-4 bg-stone-800 text-white rounded-full font-bold flex items-center justify-center gap-2">
                                <Icon name="printer" size={16} /> 导出协议
                            </button>
                            <button onClick={() => {localStorage.clear(); location.reload();}} className="px-6 py-4 text-stone-400 font-bold">重置</button>
                        </div>
                    </section>

                    {/* Fixed Nav */}
                    <nav className="fixed bottom-8 left-1/2 -translate-x-1/2 no-print">
                        <div className="glass-card px-8 py-3 rounded-full flex gap-8 items-center text-[10px] font-bold text-stone-400 tracking-widest">
                            <button onClick={() => scrollTo('intro')}>INTRO</button>
                            <button onClick={() => scrollTo('phase-1')}>VISION</button>
                            <button onClick={() => scrollTo('phase-2')}>IDENTITY</button>
                        </div>
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
