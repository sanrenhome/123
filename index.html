<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿä¿®å¤æŒ‡å— v2.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #fcfaf7; --text: #1c1917; }
        .dark { --bg: #171717; --text: #e7e5e4; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); transition: all 0.4s; }
        .serif { font-family: 'Noto Serif SC', serif; }
        .card { background: white; border: 1px solid #e7e5e4; border-radius: 1.5rem; padding: 2rem; }
        .dark .card { background: #262626; border-color: #44403c; }
        textarea { background: #f9f8f6; border: 1px solid #e7e5e4; }
        .dark textarea { background: #171717; border-color: #44403c; color: #e7e5e4; }
        .section-hidden { display: none; }
        input[type="range"] { accent-color: #1c1917; }
        .dark input[type="range"] { accent-color: #d1d5db; }
    </style>
</head>
<body class="pb-32">
<div class="max-w-3xl mx-auto px-6">

    <!-- é¡¶éƒ¨æ  -->
    <div class="flex justify-between items-center py-6 sticky top-0 bg-inherit z-50">
        <div class="flex items-center gap-3">
            <span class="text-2xl font-bold serif">äººç”Ÿä¿®å¤ v2.0</span>
            <div id="progress-bar" class="h-1.5 bg-stone-200 dark:bg-stone-700 rounded-full w-32 overflow-hidden">
                <div id="progress-fill" class="h-full bg-stone-900 dark:bg-white w-0 transition-all"></div>
            </div>
            <span id="progress-text" class="text-xs font-mono text-stone-500">0%</span>
        </div>
        <div class="flex items-center gap-3">
            <button onclick="toggleDark()" class="w-10 h-10 flex items-center justify-center text-2xl rounded-2xl border border-stone-300 dark:border-stone-600 hover:scale-110">ğŸŒ™</button>
            <button onclick="exportPDF()" class="px-6 py-2.5 text-sm font-bold bg-stone-900 text-white dark:bg-white dark:text-stone-900 rounded-3xl">å¯¼å‡º PDF</button>
            <button onclick="shareAsImage()" class="px-6 py-2.5 text-sm font-bold border border-stone-900 dark:border-white rounded-3xl">åˆ†äº«å¡ç‰‡</button>
        </div>
    </div>

    <!-- åŸæœ‰ header -->
    <header id="intro" class="min-h-screen flex flex-col justify-center items-center text-center space-y-10">
        <div class="space-y-4">
            <h1 class="text-5xl md:text-6xl font-bold serif tracking-tight">äººç”Ÿä¿®å¤æŒ‡å—</h1>
            <p class="text-stone-400 dark:text-stone-500 uppercase tracking-[0.3em] text-xs">Based on Dan Koe Philosophy â€¢ v2.0</p>
        </div>
        <div class="card italic serif text-stone-600 dark:text-stone-400 leading-relaxed text-lg max-w-xl border-l-4 border-l-stone-900">
            â€œèº«ä»½é©±åŠ¨è¡Œä¸ºã€‚é™¤éä½ æ”¹å˜â€˜æˆ‘æ˜¯è°â€™ï¼Œå¦åˆ™ä½ çš„â€˜åšä»€ä¹ˆâ€™æ°¸è¿œåªæ˜¯ç—›è‹¦çš„åšå¼ˆã€‚â€
        </div>
        <button onclick="showSection('phase-anti')" class="px-12 py-5 bg-stone-900 text-white rounded-full font-bold text-lg shadow-2xl hover:scale-105 transition-all">
            ç­¾ç½²åè®®ï¼šæˆ‘æ‰¿è¯ºä»Šå¤©å½»åº•è‡ªçœ
        </button>
    </header>

    <!-- å…¶ä½™ä¸‰ä¸ª section ä¸åŸç‰ˆä¸€è‡´ï¼Œä»…å¢åŠ  dark ç±»å…¼å®¹ -->
    <section id="phase-anti" class="section-hidden space-y-12 py-20">
        <!-- åŸå†…å®¹ä¿æŒä¸å˜ï¼Œå¤åˆ¶ä½ åŸæ¥çš„ phase-anti å³å¯ -->
        <div class="border-b border-stone-200 dark:border-stone-700 pb-8">
            <h2 class="text-4xl font-bold serif">01. åå‘æ„¿æ™¯æŒ–æ˜</h2>
            <p class="text-stone-500 dark:text-stone-400 mt-4">å¦‚æœä½ ä¸æ”¹å˜ï¼Œçœ‹çœ‹ 5-10 å¹´åé‚£ä¸ªè…çƒ‚çš„æœªæ¥ã€‚</p>
        </div>
        <!-- å››ä¸ª textarea ä¿æŒåŸæ ·ï¼Œid ä¸å˜ -->
        <div class="grid gap-8">
            <div class="card">
                <h3 class="font-bold mb-2 flex items-center gap-2">ğŸ©º å¥åº·ä¸èº«ä½“</h3>
                <textarea id="av-health" oninput="sync()" placeholder="æˆ‘çœ‹åˆ°çš„æœªæ¥æ˜¯..."></textarea>
            </div>
            <!-- finance, relationships, summary åŒç† -->
            <!-- çœç•¥ä»¥èŠ‚çœç¯‡å¹…ï¼Œä¿æŒä½ åŸæ¥çš„ä¸‰ä¸ª + summary -->
        </div>
        <button onclick="showSection('phase-identity')" class="w-full py-5 bg-stone-900 text-white rounded-full font-bold text-lg">è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼šå®šä¹‰æ–°èº«ä»½ â†’</button>
    </section>

    <!-- phase-identity åŒç†ï¼Œä¿æŒåŸæ · -->

    <!-- phase-plan é‡ç£…å‡çº§ -->
    <section id="phase-plan" class="section-hidden space-y-12 py-20">
        <div class="border-b border-stone-200 dark:border-stone-700 pb-8">
            <h2 class="text-4xl font-bold serif">03. è¿è¡Œç³»ç»Ÿ</h2>
            <p class="text-stone-500 dark:text-stone-400 mt-4">æŠŠæ„¿æ™¯æ‹†è§£ä¸ºå¯æ‰§è¡Œçš„ç¡¬æŠ€èƒ½å’Œæ¯æ—¥æœºåˆ¶ã€‚</p>
        </div>

        <!-- åŠ¨æ€æŠ€èƒ½ -->
        <div class="card">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold uppercase tracking-widest text-xs">æ ¸å¿ƒæŠ€èƒ½è§£é”</h3>
                <button onclick="addSkill()" class="px-5 py-2 text-xs font-bold border border-stone-900 dark:border-white rounded-3xl flex items-center gap-2">
                    <span class="text-lg leading-none">+</span> æ·»åŠ æŠ€èƒ½
                </button>
            </div>
            <div id="skills-container" class="space-y-8"></div>
        </div>

        <!-- æ¯æ—¥æ‰¿è¯ºæ‰“å¡ -->
        <div class="card">
            <h3 class="font-bold mb-2">æ¯æ—¥ä¸å¯å¦¥åä»»åŠ¡</h3>
            <p class="text-xs text-stone-400 mb-6">ä»Šå¤©å¿…é¡»å®Œæˆçš„ 3-5 ä»¶äº‹ï¼Œæ‰“å¡åè‡ªåŠ¨è®°å½• streak</p>
            <div id="daily-list" class="space-y-4"></div>
            <button onclick="addDaily()" class="mt-6 w-full py-3 border border-dashed border-stone-400 dark:border-stone-600 rounded-2xl text-sm font-medium">+ æ·»åŠ æ–°ä»»åŠ¡</button>
            <div class="mt-8 flex items-center justify-between bg-stone-100 dark:bg-stone-800 p-6 rounded-3xl">
                <div>
                    <div class="text-xs text-stone-500">è¿ç»­æ‰“å¡</div>
                    <div id="streak" class="streak font-bold text-5xl text-amber-500">0</div>
                    <div class="text-xs text-stone-500">å¤© ğŸ”¥</div>
                </div>
                <button onclick="markTodayComplete()" class="px-10 py-5 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-3xl text-lg transition">âœ… æ ‡è®°ä»Šå¤©å®Œæˆ</button>
            </div>
        </div>

        <div class="flex gap-4">
            <button onclick="exportPDF()" class="flex-1 py-5 bg-stone-900 text-white rounded-full font-bold">å¯¼å‡ºæˆ‘çš„ç”Ÿå‘½åè®® PDF</button>
            <button onclick="resetAll()" class="px-8 py-5 text-stone-300 font-bold hover:text-red-500">é‡ç½®å…¨éƒ¨</button>
        </div>
    </section>
</div>

<!-- åº•éƒ¨å¯¼èˆªæ  -->
<nav id="navbar" class="section-hidden fixed bottom-10 left-1/2 -translate-x-1/2 bg-white/90 dark:bg-stone-900/90 backdrop-blur-xl border border-stone-200 dark:border-stone-700 px-10 py-4 rounded-full flex gap-8 shadow-2xl">
    <button onclick="showSection('intro')" class="text-xs font-bold tracking-widest">INTRO</button>
    <button onclick="showSection('phase-anti')" class="text-xs font-bold tracking-widest">ANTI-VISION</button>
    <button onclick="showSection('phase-identity')" class="text-xs font-bold tracking-widest">IDENTITY</button>
    <button onclick="showSection('phase-plan')" class="text-xs font-bold tracking-widest">SYSTEM</button>
</nav>

<script>
// ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
let skills = [
    {id:1, name:"å†™ä½œ", level:0},
    {id:2, name:"ä¸“æ³¨", level:0},
    {id:3, name:"é˜…è¯»", level:0},
    {id:4, name:"æ‰§è¡ŒåŠ›", level:0}
];

let dailyTasks = [
    {id:1, text:"4å°æ—¶æ·±åº¦å·¥ä½œ", done:false},
    {id:2, text:"é˜…è¯»20é¡µ", done:false},
    {id:3, text:"è¿åŠ¨30åˆ†é’Ÿ", done:false}
];

let streakData = { lastDate: null, streak: 0 };

const fieldIds = ['av-health','av-finance','av-relationships','av-summary','id-iam','id-drivers','plan-mechanisms'];

// Tailwind dark mode
function toggleDark() {
    document.documentElement.classList.toggle('dark');
    localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
}

// æ˜¾ç¤º section
function showSection(id) {
    document.querySelectorAll('.section-hidden').forEach(s => s.classList.add('section-hidden'));
    document.getElementById(id).classList.remove('section-hidden');
    if (id !== 'intro') document.getElementById('navbar').classList.remove('section-hidden');
    window.scrollTo({top:0, behavior:'smooth'});
    updateProgress();
}

// åŠ¨æ€æ¸²æŸ“æŠ€èƒ½
function renderSkills() {
    const container = document.getElementById('skills-container');
    container.innerHTML = '';
    skills.forEach((skill, index) => {
        const div = document.createElement('div');
        div.className = 'skill-item flex flex-col gap-3';
        div.innerHTML = `
            <div class="flex justify-between items-center">
                <input value="${skill.name}" oninput="updateSkillName(${index}, this.value)" class="bg-transparent border-b border-stone-300 dark:border-stone-600 focus:border-stone-900 dark:focus:border-white outline-none font-bold text-lg w-40">
                <div class="flex items-center gap-4">
                    <span id="skill-val-${index}" class="font-mono text-sm whitespace-nowrap">Level ${skill.level}</span>
                    <button onclick="deleteSkill(${index})" class="text-red-400 hover:text-red-600 text-xl leading-none">Ã—</button>
                </div>
            </div>
            <input type="range" min="0" max="100" value="${skill.level}" oninput="updateSkillLevel(${index}, this.value)">
        `;
        container.appendChild(div);
    });
}

function updateSkillName(index, val) { skills[index].name = val; sync(); }
function updateSkillLevel(index, val) {
    skills[index].level = parseInt(val);
    document.getElementById(`skill-val-${index}`).textContent = `Level ${val}`;
    sync();
    updateProgress();
}
function addSkill() {
    skills.push({id: Date.now(), name:"æ–°æŠ€èƒ½", level:0});
    renderSkills();
    sync();
}
function deleteSkill(index) {
    if(skills.length <= 1) return alert("è‡³å°‘ä¿ç•™ä¸€ä¸ªæŠ€èƒ½");
    skills.splice(index,1);
    renderSkills();
    sync();
}

// æ¯æ—¥ä»»åŠ¡
function renderDaily() {
    const container = document.getElementById('daily-list');
    container.innerHTML = '';
    dailyTasks.forEach((task, i) => {
        const div = document.createElement('div');
        div.className = 'flex items-center gap-3';
        div.innerHTML = `
            <input type="checkbox" ${task.done?'checked':''} onchange="toggleDaily(${i},this.checked)" class="w-5 h-5 accent-stone-900 dark:accent-white">
            <input value="${task.text}" oninput="updateDailyText(${i},this.value)" class="flex-1 bg-transparent border-b border-stone-300 dark:border-stone-600 focus:border-stone-900 outline-none">
            <button onclick="deleteDaily(${i})" class="text-stone-400 hover:text-red-500">Ã—</button>
        `;
        container.appendChild(div);
    });
}
function toggleDaily(i, checked) {
    dailyTasks[i].done = checked;
    sync();
}
function updateDailyText(i, val) { dailyTasks[i].text = val; sync(); }
function addDaily() {
    dailyTasks.push({id:Date.now(), text:"æ–°ä»»åŠ¡", done:false});
    renderDaily();
    sync();
}
function deleteDaily(i) {
    if(dailyTasks.length <= 1) return;
    dailyTasks.splice(i,1);
    renderDaily();
    sync();
}

// æ‰“å¡ & streak
function markTodayComplete() {
    const today = new Date().toISOString().slice(0,10);
    const allDone = dailyTasks.every(t => t.done);
    if (!allDone) return alert("è¯·å…ˆå®Œæˆä»Šå¤©çš„æ‰€æœ‰ä»»åŠ¡å†æ‰“å¡ï¼");

    if (streakData.lastDate === today) {
        alert("ä»Šå¤©å·²ç»æ‰“å¡å•¦ï¼");
        return;
    }

    const yesterday = new Date(Date.now() - 86400000).toISOString().slice(0,10);
    if (streakData.lastDate === yesterday) {
        streakData.streak++;
    } else {
        streakData.streak = 1;
    }
    streakData.lastDate = today;

    document.getElementById('streak').textContent = streakData.streak;
    sync();
    alert(`ğŸ‰ æ‰“å¡æˆåŠŸï¼å½“å‰è¿ç»­ ${streakData.streak} å¤©`);
}

// è¿›åº¦è®¡ç®—
function updateProgress() {
    let filled = 0;
    fieldIds.forEach(id => {
        const el = document.getElementById(id);
        if (el && el.value.trim().length > 10) filled++;
    });
    // æŠ€èƒ½å¹³å‡ç­‰çº§ >30 ç®—å®Œæˆ
    const avgSkill = skills.reduce((a,s)=>a+s.level,0) / skills.length;
    if (avgSkill > 30) filled++;

    const total = fieldIds.length + 1;
    const percent = Math.round((filled / total) * 100);
    document.getElementById('progress-fill').style.width = percent + '%';
    document.getElementById('progress-text').textContent = percent + '%';
}

// ä¿å­˜ & åŠ è½½
function sync() {
    const data = {skills, dailyTasks, streakData};
    fieldIds.forEach(id => {
        const el = document.getElementById(id);
        if (el) data[id] = el.value;
    });
    localStorage.setItem('life-repair-v2', JSON.stringify(data));
    updateProgress();
}

function loadData() {
    const saved = localStorage.getItem('life-repair-v2');
    if (saved) {
        const data = JSON.parse(saved);
        skills = data.skills || skills;
        dailyTasks = data.dailyTasks || dailyTasks;
        streakData = data.streakData || streakData;

        fieldIds.forEach(id => {
            if (data[id]) {
                const el = document.getElementById(id);
                if (el) el.value = data[id];
            }
        });
    }
    renderSkills();
    renderDaily();
    document.getElementById('streak').textContent = streakData.streak;
    updateProgress();
}

// PDF å¯¼å‡ºï¼ˆè¶…ç¾ï¼‰
async function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({orientation:'portrait', unit:'mm', format:'a4'});

    // æ ‡é¢˜
    doc.setFont("helvetica","bold");
    doc.setFontSize(28);
    doc.text("äººç”Ÿä¿®å¤åè®®", 105, 30, {align:"center"});

    doc.setFontSize(12);
    doc.text(`ç­¾ç½²æ—¥æœŸï¼š${new Date().toLocaleDateString('zh-CN')}`, 105, 45, {align:"center"});

    // å†…å®¹
    let y = 60;
    doc.setFontSize(14);
    doc.text("01 åå‘æ„¿æ™¯", 20, y); y+=10;
    doc.setFontSize(11);
    doc.text(document.getElementById('av-summary').value || "æœªå¡«å†™", 20, y, {maxWidth:170}); y+=30;

    // èº«ä»½
    doc.setFontSize(14);
    doc.text("02 æ–°èº«ä»½", 20, y); y+=10;
    doc.setFontSize(11);
    doc.text(document.getElementById('id-iam').value || "æœªå¡«å†™", 20, y, {maxWidth:170}); y+=40;

    // æŠ€èƒ½
    doc.setFontSize(14);
    doc.text("03 æ ¸å¿ƒæŠ€èƒ½", 20, y); y+=10;
    skills.forEach(s => {
        doc.text(`${s.name} â€” Level ${s.level}`, 20, y);
        y += 8;
    });

    // æ‰“å¡
    doc.text(`å½“å‰ streakï¼š${streakData.streak} å¤© ğŸ”¥`, 20, y+10);

    doc.setFontSize(10);
    doc.text("â€”â€” æˆ‘å·²ç­¾ç½²æ­¤åè®®ï¼Œä»ä»Šå¤©èµ·å½»åº•æ”¹å˜ â€”â€”", 105, 280, {align:"center"});

    doc.save(`äººç”Ÿä¿®å¤åè®®_${new Date().toISOString().slice(0,10)}.pdf`);
}

// åˆ†äº«å¡ç‰‡ PNG
async function shareAsImage() {
    const card = document.createElement('div');
    card.style.cssText = `width:600px;height:800px;background:linear-gradient(135deg,#1c1917,#44403c);color:white;padding:60px;display:flex;flex-direction:column;justify-content:space-between;font-family:system-ui;border-radius:24px;position:fixed;left:-9999px;`;
    card.innerHTML = `
        <div>
            <div style="font-size:48px;font-weight:900;">äººç”Ÿä¿®å¤æŒ‡å—</div>
            <div style="margin-top:40px;font-size:22px;line-height:1.6;">${document.getElementById('id-iam').value || 'æˆ‘æ˜¯ä¸€ä¸ªæ¯å¤©éƒ½åœ¨å˜æ›´å¥½çš„äºº'}</div>
        </div>
        <div style="text-align:center;">
            <div style="font-size:80px;">${streakData.streak}</div>
            <div style="font-size:18px;opacity:0.7;">å¤©è¿ç»­æ‰“å¡</div>
            <div style="margin-top:60px;font-size:14px;opacity:0.6;">${new Date().toLocaleDateString('zh-CN')}</div>
        </div>
    `;
    document.body.appendChild(card);

    const canvas = await html2canvas(card, {scale:2});
    document.body.removeChild(card);

    const link = document.createElement('a');
    link.download = 'æˆ‘çš„ä¿®å¤å¡ç‰‡.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
}

// é‡ç½®
function resetAll() {
    if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®é‡æ–°å¼€å§‹å—ï¼Ÿ')) {
        localStorage.removeItem('life-repair-v2');
        location.reload();
    }
}

// åˆå§‹åŒ–
window.onload = () => {
    // ä¸»é¢˜
    if (localStorage.getItem('theme') === 'dark' || (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
    }
    loadData();
    // é»˜è®¤æ˜¾ç¤º intro
    showSection('intro');
};
</script>
</body>
</html>
