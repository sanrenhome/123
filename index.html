<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人生修复指南 | Life Repair Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #fcfaf7; color: #1c1917; }
        .serif { font-family: 'Noto Serif SC', serif; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #fcfaf7; }
        ::-webkit-scrollbar-thumb { background: #e7e5e4; border-radius: 10px; }
        @media print { .no-print { display: none !important; } }
        /* 这里的 CSS 模拟了 Lucide 图标的显示 */
        .icon { display: inline-block; width: 1em; height: 1em; stroke-width: 0; stroke: currentColor; fill: currentColor; }
    </style>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@^18.2.0",
        "react-dom": "https://esm.sh/react-dom@^18.2.0",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1",
        "@google/genai": "https://esm.sh/@google/genai@1.41.0"
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom';
        import * as Lucide from 'lucide-react';
        import { GoogleGenAI } from "@google/genai";

        // --- 数据常量 ---
        const QUOTES = [
            { cn: "你想拥有的生活，建立在你不敢放手的废墟之上。", en: "The life you want is built on the ruins of the life you are afraid to let go of." },
            { cn: "如果你不知道自己想要什么，看看你讨厌什么。反向愿景通常比正向目标更具动力。", en: "If you don't know what you want, look at what you hate." }
        ];

        const INITIAL_STATE = {
            date: new Date().toISOString().split('T')[0],
            commitment: false,
            antiVision: { health: '', relationships: '', finance: '', work: '', selfTalk: '', summary: '', rootCause: '' },
            newIdentity: { naturalActions: '', iAmStatements: '', drivers: '', trueTodoList: '' },
            planning: { skills: [{name:'', level:0, unlockCondition:''}, {name:'', level:0, unlockCondition:''}], mechanisms: [], mechanismsDetail: '', milestones: '' },
            completedPhases: [],
            aiOptimalPath: ''
        };

        // --- 组件部分 ---
        const ReflectionBox = ({ title, description, value, onChange, onExpand, isExpanding, icon: Icon, minimal = false }) => (
            <div className={`space-y-4 ${minimal ? '' : 'group'} relative`}>
                <div className="flex justify-between items-start">
                    <div className="space-y-1">
                        {!minimal && (<div className="flex items-center gap-2">{Icon && <Icon className="text-orange-600/60" size={20} />}<h3 className="text-lg font-bold serif text-stone-800">{title}</h3></div>)}
                        {minimal && <h4 className="text-xs font-bold text-stone-400 uppercase tracking-widest">{title}</h4>}
                    </div>
                    {onExpand && (
                        <button onClick={onExpand} className="flex items-center gap-1.5 px-3 py-1.5 bg-stone-100 text-stone-500 rounded-lg text-[10px] font-bold hover:bg-amber-50 transition-all">
                            {isExpanding ? "扩写中..." : "AI扩写"}
                        </button>
                    )}
                </div>
                <p className="text-stone-400 text-xs">{description}</p>
                <textarea 
                    value={value} 
                    onChange={(e) => onChange(e.target.value)} 
                    placeholder="开始你的深度自省..." 
                    className="w-full bg-white border border-stone-200 rounded-2xl p-6 text-stone-800 focus:outline-none focus:ring-4 focus:ring-stone-50 min-h-[160px] transition-all resize-none shadow-sm"
                />
            </div>
        );

        const App = () => {
            const [state, setState] = useState(() => {
                const saved = localStorage.getItem('life-reset-data');
                return saved ? JSON.parse(saved) : INITIAL_STATE;
            });
            const [isExpanding, setIsExpanding] = useState(null);

            useEffect(() => {
                localStorage.setItem('life-reset-data', JSON.stringify(state));
            }, [state]);

            const updateState = (path, value) => {
                const keys = path.split('.');
                const newState = { ...state };
                let current = newState;
                for (let i = 0; i < keys.length - 1; i++) current = current[keys[i]];
                current[keys[keys.length - 1]] = value;
                setState(newState);
            };

            const scrollToNext = (id) => document.getElementById(id)?.scrollIntoView({ behavior: 'smooth' });

            return (
                <div className="min-h-screen px-4 py-12">
                    <div className="max-w-3xl mx-auto space-y-32">
                        
                        {/* 引导页 */}
                        <section id="intro" className="min-h-[80vh] flex flex-col justify-center items-center text-center space-y-8">
                            <h1 className="text-4xl md:text-6xl font-bold serif">人生修复指南</h1>
                            <div className="bg-white border p-8 rounded-3xl text-left space-y-6 shadow-sm">
                                {QUOTES.map((q, i) => (
                                    <div key={i}><p className="serif text-lg">“{q.cn}”</p></div>
                                ))}
                            </div>
                            <div className="flex flex-col gap-6 w-full max-w-sm">
                                <label className="flex items-center gap-3 cursor-pointer">
                                    <input type="checkbox" checked={state.commitment} onChange={(e) => updateState('commitment', e.target.checked)} />
                                    <span className="text-stone-500">我承诺今天花一整天深度自省</span>
                                </label>
                                <button 
                                    disabled={!state.commitment} 
                                    onClick={() => scrollToNext('phase-1')}
                                    className={`py-4 rounded-full font-bold ${state.commitment ? 'bg-stone-900 text-stone-50' : 'bg-stone-200 text-stone-400'}`}
                                >
                                    开始修复 ↓
                                </button>
                            </div>
                        </section>

                        {/* 阶段 1 */}
                        <section id="phase-1" className="space-y-12">
                            <h2 className="text-3xl font-bold serif">01. 反向愿景挖掘</h2>
                            <ReflectionBox 
                                title="健康与身体" 
                                icon={Lucide.ShieldAlert}
                                description="描述 5-10 年后最惨的样子。" 
                                value={state.antiVision.health} 
                                onChange={(val) => updateState('antiVision.health', val)} 
                            />
                            <ReflectionBox 
                                title="财务焦虑的深度" 
                                icon={Lucide.AlertTriangle}
                                description="写下你不得不放弃尊严的时刻。" 
                                value={state.antiVision.finance} 
                                onChange={(val) => updateState('antiVision.finance', val)} 
                            />
                            <button onClick={() => scrollToNext('phase-2')} className="w-full py-4 border-2 border-stone-900 rounded-full font-bold hover:bg-stone-900 hover:text-white transition-all">
                                完成第一阶段，定义身份 →
                            </button>
                        </section>

                        {/* 阶段 2 */}
                        <section id="phase-2" className="space-y-12">
                            <h2 className="text-3xl font-bold serif">02. 新身份定义</h2>
                            <ReflectionBox 
                                title="我是谁：坚定宣言" 
                                icon={Lucide.Zap}
                                description="写下 3-5 句以‘我是……的人’开头的陈述。" 
                                value={state.newIdentity.iAmStatements} 
                                onChange={(val) => updateState('newIdentity.iAmStatements', val)} 
                            />
                            <button onClick={() => window.print()} className="w-full py-4 bg-stone-900 text-white rounded-full font-bold shadow-lg">
                                导出协议 / 打印 PDF
                            </button>
                        </section>
                    </div>

                    {/* 底部导航 */}
                    <nav className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/80 backdrop-blur-md border px-8 py-3 rounded-full flex gap-6 shadow-xl no-print">
                        <button onClick={() => scrollToNext('intro')} className="text-xs font-bold text-stone-400">首页</button>
                        <button onClick={() => scrollToNext('phase-1')} className="text-xs font-bold text-stone-400">痛点</button>
                        <button onClick={() => scrollToNext('phase-2')} className="text-xs font-bold text-stone-400">身份</button>
                    </nav>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
